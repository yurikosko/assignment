"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const test_run_tracker_1 = __importDefault(require("../../api/test-run-tracker"));
const prerender_callsite_1 = __importDefault(require("../../utils/prerender-callsite"));
const test_controller_1 = __importDefault(require("../../api/test-controller"));
const observed_callsites_storage_1 = __importDefault(require("../../test-run/observed-callsites-storage"));
const warning_log_1 = __importDefault(require("../../notifications/warning-log"));
const executor_1 = __importDefault(require("../../assertions/executor"));
const type_1 = __importDefault(require("../../test-run/commands/type"));
const serviceCommands = __importStar(require("../../test-run/commands/service"));
class TestRunProxy {
    constructor({ dispatcher, id, fixtureCtx, options }) {
        this.dispatcher = dispatcher;
        this.id = id;
        this.ctx = Object.create(null);
        this.fixtureCtx = fixtureCtx;
        this._options = options;
        // TODO: Synchronize these properties with their real counterparts in the main process.
        // Postponed until (GH-3244). See details in (GH-5250).
        this.controller = new test_controller_1.default(this);
        this.observedCallsites = new observed_callsites_storage_1.default();
        this.warningLog = new warning_log_1.default();
        this._requestHooks = [];
        test_run_tracker_1.default.activeTestRuns[id] = this;
    }
    _getAssertionTimeout(command) {
        // @ts-ignore
        const { timeout: commandTimeout } = command.options;
        return commandTimeout === void 0
            ? this._options.assertionTimeout
            : commandTimeout;
    }
    async _executeAssertion(command, callsite) {
        const assertionTimeout = this._getAssertionTimeout(command);
        const executor = new executor_1.default(command, assertionTimeout, callsite);
        executor.once('start-assertion-retries', timeout => this.executeCommand(new serviceCommands.ShowAssertionRetriesStatusCommand(timeout)));
        executor.once('end-assertion-retries', success => this.executeCommand(new serviceCommands.HideAssertionRetriesStatusCommand(success)));
        return executor.run();
    }
    getHook(hookId) {
        return this._requestHooks.find(hook => hook.id === hookId);
    }
    async executeAction(apiMethodName, command, callsite) {
        if (callsite)
            callsite = prerender_callsite_1.default(callsite);
        if (command.type === type_1.default.assertion)
            return this._executeAssertion(command, callsite);
        return this.dispatcher.executeAction({ apiMethodName, command, callsite, id: this.id });
    }
    async executeCommand(command) {
        return this.dispatcher.executeCommand({ command, id: this.id });
    }
    initializeRequestHooks(test) {
        this._requestHooks = Array.from(test.requestHooks);
        this._requestHooks.forEach(requestHook => {
            requestHook._warningLog = this.warningLog;
        });
    }
    onRequestHookEvent({ hookId, name, eventData }) {
        const targetHook = this.getHook(hookId);
        // @ts-ignore
        targetHook[name].call(targetHook, eventData);
    }
}
exports.default = TestRunProxy;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC1ydW4tcHJveHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmljZXMvY29tcGlsZXIvdGVzdC1ydW4tcHJveHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsa0ZBQXdEO0FBQ3hELHdGQUErRDtBQUcvRCxnRkFBdUQ7QUFDdkQsMkdBQWlGO0FBQ2pGLGtGQUF5RDtBQUV6RCx5RUFBMEQ7QUFFMUQsd0VBQXdEO0FBRXhELGlGQUFtRTtBQWlCbkUsTUFBTSxZQUFZO0lBWWQsWUFBb0IsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQW9CO1FBQ3pFLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBRTdCLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBRWIsSUFBSSxDQUFDLEdBQUcsR0FBVSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxRQUFRLEdBQUssT0FBTyxDQUFDO1FBRTFCLHVGQUF1RjtRQUN2Rix1REFBdUQ7UUFDdkQsSUFBSSxDQUFDLFVBQVUsR0FBVSxJQUFJLHlCQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksb0NBQXdCLEVBQUUsQ0FBQztRQUN4RCxJQUFJLENBQUMsVUFBVSxHQUFVLElBQUkscUJBQVUsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxhQUFhLEdBQU8sRUFBRSxDQUFDO1FBRTVCLDBCQUFjLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUM3QyxDQUFDO0lBRU8sb0JBQW9CLENBQUUsT0FBeUI7UUFDbkQsYUFBYTtRQUNiLE1BQU0sRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztRQUVwRCxPQUFPLGNBQWMsS0FBSyxLQUFLLENBQUM7WUFDNUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCO1lBQ2hDLENBQUMsQ0FBQyxjQUFjLENBQUM7SUFDekIsQ0FBQztJQUVPLEtBQUssQ0FBQyxpQkFBaUIsQ0FBRSxPQUF5QixFQUFFLFFBQWlCO1FBQ3pFLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTVELE1BQU0sUUFBUSxHQUFHLElBQUksa0JBQWlCLENBQUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTVFLFFBQVEsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksZUFBZSxDQUFDLGlDQUFpQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6SSxRQUFRLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLGVBQWUsQ0FBQyxpQ0FBaUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdkksT0FBTyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVPLE9BQU8sQ0FBRSxNQUFjO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLE1BQU0sQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFTSxLQUFLLENBQUMsYUFBYSxDQUFFLGFBQXFCLEVBQUUsT0FBZ0IsRUFBRSxRQUFpQjtRQUNsRixJQUFJLFFBQVE7WUFDUixRQUFRLEdBQUcsNEJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFM0MsSUFBSyxPQUF1QixDQUFDLElBQUksS0FBSyxjQUFZLENBQUMsU0FBUztZQUN4RCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUEyQixFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRXpFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDNUYsQ0FBQztJQUVNLEtBQUssQ0FBQyxjQUFjLENBQUUsT0FBZ0I7UUFDekMsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVNLHNCQUFzQixDQUFFLElBQVU7UUFDckMsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVuRCxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUNyQyxXQUFXLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU0sa0JBQWtCLENBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBOEI7UUFDOUUsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUV4QyxhQUFhO1FBQ2IsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDakQsQ0FBQztDQUNKO0FBRUQsa0JBQWUsWUFBWSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHRlc3RSdW5UcmFja2VyIGZyb20gJy4uLy4uL2FwaS90ZXN0LXJ1bi10cmFja2VyJztcbmltcG9ydCBwcmVyZW5kZXJDYWxsc2l0ZSBmcm9tICcuLi8uLi91dGlscy9wcmVyZW5kZXItY2FsbHNpdGUnO1xuXG5pbXBvcnQgeyBUZXN0UnVuRGlzcGF0Y2hlclByb3RvY29sIH0gZnJvbSAnLi9wcm90b2NvbCc7XG5pbXBvcnQgVGVzdENvbnRyb2xsZXIgZnJvbSAnLi4vLi4vYXBpL3Rlc3QtY29udHJvbGxlcic7XG5pbXBvcnQgT2JzZXJ2ZWRDYWxsc2l0ZXNTdG9yYWdlIGZyb20gJy4uLy4uL3Rlc3QtcnVuL29ic2VydmVkLWNhbGxzaXRlcy1zdG9yYWdlJztcbmltcG9ydCBXYXJuaW5nTG9nIGZyb20gJy4uLy4uL25vdGlmaWNhdGlvbnMvd2FybmluZy1sb2cnO1xuaW1wb3J0IEFzc2VydGlvbkNvbW1hbmQgZnJvbSAnLi4vLi4vdGVzdC1ydW4vY29tbWFuZHMvYXNzZXJ0aW9uJztcbmltcG9ydCBBc3NlcnRpb25FeGVjdXRvciBmcm9tICcuLi8uLi9hc3NlcnRpb25zL2V4ZWN1dG9yJztcbmltcG9ydCB7IERpY3Rpb25hcnkgfSBmcm9tICcuLi8uLi9jb25maWd1cmF0aW9uL2ludGVyZmFjZXMnO1xuaW1wb3J0IENPTU1BTkRfVFlQRSBmcm9tICcuLi8uLi90ZXN0LXJ1bi9jb21tYW5kcy90eXBlJztcbmltcG9ydCBDb21tYW5kQmFzZSBmcm9tICcuLi8uLi90ZXN0LXJ1bi9jb21tYW5kcy9iYXNlJztcbmltcG9ydCAqIGFzIHNlcnZpY2VDb21tYW5kcyBmcm9tICcuLi8uLi90ZXN0LXJ1bi9jb21tYW5kcy9zZXJ2aWNlJztcbmltcG9ydCB7IFRlc3RSdW5Qcm94eUluaXQgfSBmcm9tICcuLi9pbnRlcmZhY2VzJztcbmltcG9ydCBUZXN0IGZyb20gJy4uLy4uL2FwaS9zdHJ1Y3R1cmUvdGVzdCc7XG5pbXBvcnQgUmVxdWVzdEhvb2sgZnJvbSAnLi4vLi4vYXBpL3JlcXVlc3QtaG9va3MvaG9vayc7XG5pbXBvcnQgUmVxdWVzdEhvb2tNZXRob2ROYW1lcyBmcm9tICcuLi8uLi9hcGkvcmVxdWVzdC1ob29rcy9ob29rLW1ldGhvZC1uYW1lcyc7XG5pbXBvcnQge1xuICAgIENvbmZpZ3VyZVJlc3BvbnNlRXZlbnQsXG4gICAgUmVxdWVzdEV2ZW50LFxuICAgIFJlc3BvbnNlRXZlbnRcbn0gZnJvbSAndGVzdGNhZmUtaGFtbWVyaGVhZCc7XG5cbmludGVyZmFjZSBSZXF1ZXN0SG9va0V2ZW50RGVzY3JpcHRvciB7XG4gICAgaG9va0lkOiBzdHJpbmc7XG4gICAgbmFtZTogUmVxdWVzdEhvb2tNZXRob2ROYW1lcztcbiAgICBldmVudERhdGE6IFJlcXVlc3RFdmVudCB8IENvbmZpZ3VyZVJlc3BvbnNlRXZlbnQgfCBSZXNwb25zZUV2ZW50O1xufVxuXG5jbGFzcyBUZXN0UnVuUHJveHkge1xuICAgIHB1YmxpYyByZWFkb25seSBpZDogc3RyaW5nO1xuICAgIHB1YmxpYyByZWFkb25seSBjb250cm9sbGVyOiBUZXN0Q29udHJvbGxlcjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgb2JzZXJ2ZWRDYWxsc2l0ZXM6IE9ic2VydmVkQ2FsbHNpdGVzU3RvcmFnZTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgd2FybmluZ0xvZzogV2FybmluZ0xvZztcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlzcGF0Y2hlcjogVGVzdFJ1bkRpc3BhdGNoZXJQcm90b2NvbDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZpeHR1cmVDdHg6IHVua25vd247XG4gICAgcHJpdmF0ZSByZWFkb25seSBjdHg6IHVua25vd247XG4gICAgcHJpdmF0ZSByZWFkb25seSBfb3B0aW9uczogRGljdGlvbmFyeTxPcHRpb25WYWx1ZT47XG4gICAgcHJpdmF0ZSBfcmVxdWVzdEhvb2tzOiBSZXF1ZXN0SG9va1tdO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yICh7IGRpc3BhdGNoZXIsIGlkLCBmaXh0dXJlQ3R4LCBvcHRpb25zIH06IFRlc3RSdW5Qcm94eUluaXQpIHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyID0gZGlzcGF0Y2hlcjtcblxuICAgICAgICB0aGlzLmlkID0gaWQ7XG5cbiAgICAgICAgdGhpcy5jdHggICAgICAgID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5maXh0dXJlQ3R4ID0gZml4dHVyZUN0eDtcbiAgICAgICAgdGhpcy5fb3B0aW9ucyAgID0gb3B0aW9ucztcblxuICAgICAgICAvLyBUT0RPOiBTeW5jaHJvbml6ZSB0aGVzZSBwcm9wZXJ0aWVzIHdpdGggdGhlaXIgcmVhbCBjb3VudGVycGFydHMgaW4gdGhlIG1haW4gcHJvY2Vzcy5cbiAgICAgICAgLy8gUG9zdHBvbmVkIHVudGlsIChHSC0zMjQ0KS4gU2VlIGRldGFpbHMgaW4gKEdILTUyNTApLlxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgICAgICAgID0gbmV3IFRlc3RDb250cm9sbGVyKHRoaXMpO1xuICAgICAgICB0aGlzLm9ic2VydmVkQ2FsbHNpdGVzID0gbmV3IE9ic2VydmVkQ2FsbHNpdGVzU3RvcmFnZSgpO1xuICAgICAgICB0aGlzLndhcm5pbmdMb2cgICAgICAgID0gbmV3IFdhcm5pbmdMb2coKTtcbiAgICAgICAgdGhpcy5fcmVxdWVzdEhvb2tzICAgICA9IFtdO1xuXG4gICAgICAgIHRlc3RSdW5UcmFja2VyLmFjdGl2ZVRlc3RSdW5zW2lkXSA9IHRoaXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0QXNzZXJ0aW9uVGltZW91dCAoY29tbWFuZDogQXNzZXJ0aW9uQ29tbWFuZCk6IG51bWJlciB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY29uc3QgeyB0aW1lb3V0OiBjb21tYW5kVGltZW91dCB9ID0gY29tbWFuZC5vcHRpb25zO1xuXG4gICAgICAgIHJldHVybiBjb21tYW5kVGltZW91dCA9PT0gdm9pZCAwXG4gICAgICAgICAgICA/IHRoaXMuX29wdGlvbnMuYXNzZXJ0aW9uVGltZW91dFxuICAgICAgICAgICAgOiBjb21tYW5kVGltZW91dDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF9leGVjdXRlQXNzZXJ0aW9uIChjb21tYW5kOiBBc3NlcnRpb25Db21tYW5kLCBjYWxsc2l0ZTogdW5rbm93bik6IFByb21pc2U8dW5rbm93bj4ge1xuICAgICAgICBjb25zdCBhc3NlcnRpb25UaW1lb3V0ID0gdGhpcy5fZ2V0QXNzZXJ0aW9uVGltZW91dChjb21tYW5kKTtcblxuICAgICAgICBjb25zdCBleGVjdXRvciA9IG5ldyBBc3NlcnRpb25FeGVjdXRvcihjb21tYW5kLCBhc3NlcnRpb25UaW1lb3V0LCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgZXhlY3V0b3Iub25jZSgnc3RhcnQtYXNzZXJ0aW9uLXJldHJpZXMnLCB0aW1lb3V0ID0+IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IHNlcnZpY2VDb21tYW5kcy5TaG93QXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQodGltZW91dCkpKTtcbiAgICAgICAgZXhlY3V0b3Iub25jZSgnZW5kLWFzc2VydGlvbi1yZXRyaWVzJywgc3VjY2VzcyA9PiB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBzZXJ2aWNlQ29tbWFuZHMuSGlkZUFzc2VydGlvblJldHJpZXNTdGF0dXNDb21tYW5kKHN1Y2Nlc3MpKSk7XG5cbiAgICAgICAgcmV0dXJuIGV4ZWN1dG9yLnJ1bigpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0SG9vayAoaG9va0lkOiBzdHJpbmcpOiBSZXF1ZXN0SG9vayB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0SG9va3MuZmluZChob29rID0+IGhvb2suaWQgPT09IGhvb2tJZCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGV4ZWN1dGVBY3Rpb24gKGFwaU1ldGhvZE5hbWU6IHN0cmluZywgY29tbWFuZDogdW5rbm93biwgY2FsbHNpdGU6IHVua25vd24pOiBQcm9taXNlPHVua25vd24+IHtcbiAgICAgICAgaWYgKGNhbGxzaXRlKVxuICAgICAgICAgICAgY2FsbHNpdGUgPSBwcmVyZW5kZXJDYWxsc2l0ZShjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKChjb21tYW5kIGFzIENvbW1hbmRCYXNlKS50eXBlID09PSBDT01NQU5EX1RZUEUuYXNzZXJ0aW9uKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4ZWN1dGVBc3NlcnRpb24oY29tbWFuZCBhcyBBc3NlcnRpb25Db21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hlci5leGVjdXRlQWN0aW9uKHsgYXBpTWV0aG9kTmFtZSwgY29tbWFuZCwgY2FsbHNpdGUsIGlkOiB0aGlzLmlkIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBleGVjdXRlQ29tbWFuZCAoY29tbWFuZDogdW5rbm93bik6IFByb21pc2U8dW5rbm93bj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaGVyLmV4ZWN1dGVDb21tYW5kKHsgY29tbWFuZCwgaWQ6IHRoaXMuaWQgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGluaXRpYWxpemVSZXF1ZXN0SG9va3MgKHRlc3Q6IFRlc3QpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fcmVxdWVzdEhvb2tzID0gQXJyYXkuZnJvbSh0ZXN0LnJlcXVlc3RIb29rcyk7XG5cbiAgICAgICAgdGhpcy5fcmVxdWVzdEhvb2tzLmZvckVhY2gocmVxdWVzdEhvb2sgPT4ge1xuICAgICAgICAgICAgcmVxdWVzdEhvb2suX3dhcm5pbmdMb2cgPSB0aGlzLndhcm5pbmdMb2c7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBvblJlcXVlc3RIb29rRXZlbnQgKHsgaG9va0lkLCBuYW1lLCBldmVudERhdGEgfTogUmVxdWVzdEhvb2tFdmVudERlc2NyaXB0b3IpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0SG9vayA9IHRoaXMuZ2V0SG9vayhob29rSWQpO1xuXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgdGFyZ2V0SG9va1tuYW1lXS5jYWxsKHRhcmdldEhvb2ssIGV2ZW50RGF0YSk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUZXN0UnVuUHJveHk7XG5cblxuIl19